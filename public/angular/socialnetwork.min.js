(function(){angular.module("socialnetworkApp",["ngRoute","ngSanitize","ui.bootstrap","naif.base64"]);function e(e,t){e.when("/",{templateUrl:"/home/home.view.html"}).when("/profile",{templateUrl:"/profiles/own_profile/profile.view.html",controller:"profileCtrl",controllerAs:"vm"}).when("/photos",{templateUrl:"/photos/photos.view.html",controller:"photosCtrl",controllerAs:"vm"}).when("/messages",{templateUrl:"/messages/messages.view.html",controller:"messagesCtrl",controllerAs:"vm"}).when("/friends",{templateUrl:"/friends/friends.view.html",controller:"friendsCtrl",controllerAs:"vm"}).when("/userlist",{templateUrl:"/userlist/userlist.view.html",controller:"userListCtrl",controllerAs:"vm"}).when("/about",{templateUrl:"/about/about.view.html",controller:"aboutCtrl",controllerAs:"vm"}).when("/index",{templateUrl:"index/index.view.html",controller:"indexCtrl",controllerAs:"vm"}).when("/editprofile",{templateUrl:"/config/editprofile/editprofile.view.html",controller:"editProfileCtrl",controllerAs:"vm"}).otherwise({redirectTo:"/"});t.html5Mode(true)}angular.module("socialnetworkApp").config(["$routeProvider","$locationProvider",e])})();(function(){angular.module("socialnetworkApp").controller("registerCtrl",e);e.$inject=["$scope","registerUser","geoLocation"];function e(e,t,r){var o=this;o.message="Checking your location";o.getData=function(e){var r=e.coords.latitude,n=e.coords.longitude;o.message="Searching for nearby places";var i;i={name:o.register.name,firstname:o.register.firstname,lastname:o.register.lastname,email:o.register.email,password:o.register.password,lat:r,lng:n};t.register(r,n,i).success(function(e){o.message="User Create";alert("USUARIO CREADO")}).error(function(e){o.message="Sorry, something's gone wrong, please try again later"})};o.showError=function(t){e.$apply(function(){o.message=t.message})};o.noGeo=function(){e.$apply(function(){o.message="Geolocation is not supported by this browser."})};o.registerSubmit=function(){r.getPosition(o.getData,o.showError,o.noGeo)}}})();(function(){angular.module("socialnetworkApp").service("geolocation",e);function e(){var e=function(e,t,r){if(navigator.geolocation){navigator.geolocation.getCurrentPosition(e,t)}else{r()}};return{getPosition:e}}})();(function(){angular.module("socialnetworkApp").service("registerUser",e);e.$inject=["$http"];function e(e){var t=function(t,r,o){return e.post("/api/users/create",JSON.stringify(o))};return{register:t}}})();(function(){angular.module("socialnetworkApp").service("authentication",e);e.$inject=["$http","$window"];function e(e,t){var r=function(e){t.localStorage["socialnetwork-token"]=e};var o=function(){return t.localStorage["socialnetwork-token"]};var n=function(){var e=o();if(e){var r=JSON.parse(t.atob(e.split(".")[1]));return r.exp>Date.now()/1e3}else{return false}};var i=function(){if(n()){var e=o();var r=JSON.parse(t.atob(e.split(".")[1]));return{id:r._id,email:r.email,name:r.name}}};register=function(t){return e.post("/api/register",t).success(function(e){r(e.token)})};login=function(t){return e.post("/api/login",t).success(function(e){r(e.token)})};logout=function(){t.localStorage.removeItem("socialnetwork-token")};return{currentUser:i,saveToken:r,getToken:o,isLoggedIn:n,register:register,login:login,logout:logout}}})();(function(){angular.module("socialnetworkApp").service("userData",e);e.$inject=["$http","authentication"];function e(e,t){var r=function(r){return e.post("/api/users/full",r,{headers:{Authorization:"Bearer "+t.getToken()}})};var o=function(t){return e.get("/api/users/partial/"+t)};var n=function(r){return e.post("/api/users/update",r,{headers:{Authorization:"Bearer "+t.getToken()}})};var i=function(t){return e.get("/api/users")};var a=function(r){return e.post("/api/users/friend",r,{headers:{Authorization:"Bearer "+t.getToken()}})};var s=function(r){return e.post("/api/users/publication",r,{headers:{Authorization:"Bearer "+t.getToken()}})};return{getUserData:r,getUserDataById:o,updateUserData:n,getUsers:i,addFriend:a,createPublication:s}}})();(function(){angular.module("socialnetworkApp").filter("formatDistance",t);var e=function(e){return!isNaN(parseFloat(e))&&isFinite(e)};function t(){return function(t){var r,o;if(t&&e(t)){if(t>1){r=parseFloat(t).toFixed(1);o="km"}else{r=parseInt(t*1e3,10);o="m"}return r+o}else{return"?"}}}})();(function(){angular.module("socialnetworkApp").directive("footerGeneric",e);function e(){return{restrict:"EA",templateUrl:"/common/directives/footerGeneric/footerGeneric.template.html"}}})();(function(){angular.module("socialnetworkApp").directive("modal",e);function e(){return{restrict:"EA",templateUrl:"/common/directives/navigation/modal.template.html"}}})();(function(){angular.module("socialnetworkApp").directive("navigation",e);function e(){return{restrict:"EA",templateUrl:"/common/directives/navigation/navigation.template.html"}}})();(function(){angular.module("socialnetworkApp").directive("chat",e);function e(){return{restrict:"EA",scope:{content:"=content"},templateUrl:"/common/directives/chat/chat.template.html"}}})();(function(){angular.module("socialnetworkApp").directive("pageHeader",e);function e(){return{restrict:"EA",scope:{content:"=content"},templateUrl:"/common/directives/own_profile/pageHeader/pageHeader.template.html",controller:"pageHeaderCtrl"}}})();(function(){angular.module("socialnetworkApp").directive("about",e);function e(){return{restrict:"EA",scope:{content:"=content"},templateUrl:"/common/directives/own_profile/widgets/about/about.template.html"}}})();(function(){angular.module("socialnetworkApp").directive("friends",e);function e(){return{restrict:"EA",templateUrl:"/common/directives/own_profile/widgets/friends/friends.template.html",controller:"friendsCtrl"}}})();(function(){angular.module("socialnetworkApp").directive("group",e);function e(){return{restrict:"EA",templateUrl:"/common/directives/own_profile/widgets/group/group.template.html"}}})();(function(){angular.module("socialnetworkApp").directive("timeline",e);function e(){return{restrict:"EA",scope:{content:"=content"},templateUrl:"/common/directives/own_profile/timeline/timeline.template.html"}}})();(function(){angular.module("socialnetworkApp").directive("post",e);function e(){return{restrict:"EA",scope:{content:"=content"},templateUrl:"/common/directives/own_profile/timeline/post/post.template.html",controller:"postCtrl"}}})();(function(){angular.module("socialnetworkApp").directive("postState",e);function e(){return{restrict:"EA",templateUrl:"/common/directives/own_profile/timeline/postState/postState.template.html",controller:"postStateCtrl"}}})();(function(){angular.module("socialnetworkApp").controller("indexCtrl",e);e.$inject=["$location","authentication"];function e(e,t){var r=this;r.pageHeader={title:"Sign in to Loc8r"};r.credentialsLogin={email:"",password:""};r.credentialsRegister={name:"",firstname:"",lastname:"",email:"",password:""};r.returnPage="/home";r.onSubmitLogin=function(){alert("hola");r.formError="";if(!r.credentialsLogin.email||!r.credentialsLogin.password){r.formError="All fields required, please try again";return false}else{r.doLogin()}};r.doLogin=function(){r.formError="";alert("hola");t.login(r.credentialsLogin).error(function(e){r.formError=e}).then(function(){e.search("page",null);e.path(r.returnPage)})};r.onSubmitRegister=function(){r.formError="";if(!r.credentialsRegister.name||!r.credentialsRegister.email||!r.credentialsRegister.password){r.formError="All fields required, please try again";return false}else{r.doRegister()}};r.doRegister=function(){r.formError="";t.register(r.credentialsRegister).error(function(e){r.formError=e}).then(function(){e.search("page",null);e.path(r.returnPage)})}}})();(function(){angular.module("socialnetworkApp").controller("profileCtrl",e);e.$inject=["$http","authentication","userData"];function e(e,t,r){var o=this;var n;r.getUserData({}).success(function(e){n=e;o.pageHeader={name:n.name,friends:n.friends,cover:n.coverPage,profilePhoto:n.profilePhoto};o.about={birth:n.birthdate,job:n.job,gender:n.gender,address:n.address};alert(o.about.job);o.friends=n.friends;o.timeline=n.publications;return false}).error(function(e){alert(e)})}})();(function(){angular.module("socialnetworkApp").controller("photosCtrl",e);e.$inject=["$http","authentication","userData"];function e(e,t,r){var o=this;var n;r.getUserData({}).success(function(e){n=e;o.pageHeader={name:n.name,friends:n.friends,cover:n.coverPage,profilePhoto:n.profilePhoto};o.photos=n.photos;o.friends=n.friends;return false}).error(function(e){alert(e)})}})();(function(){angular.module("socialnetworkApp").controller("aboutCtrl",e);e.$inject=["$http","authentication","userData"];function e(e,t,r){var o=this;var n;r.getUserData({}).success(function(e){n=e;o.pageHeader={name:n.name,friends:n.friends,cover:n.coverPage,profilePhoto:n.profilePhoto};o.about={name:n.name,email:n.email,address:n.address,job:n.job,birthdate:n.birthdate,phone:n.phone,description:n.description,url:n.url};o.photos=n.photos;o.friend=n.friends;return false}).error(function(e){alert(e)})}})();(function(){angular.module("socialnetworkApp").controller("userListCtrl",e);e.$inject=["$http","authentication","userData"];function e(e,t,r){var o=this;r.getUsers({}).success(function(e){o.users=e;return false}).error(function(e){alert(e)});o.addFriend=function(e){r.addFriend({userid:e}).success(function(e){}).error(function(e){alert(e)})}}})();(function(){angular.module("socialnetworkApp").controller("messagesCtrl",e);e.$inject=["$http","authentication","userData"];function e(e,t,r){var o=this;o.friendSchema=[];r.getUserData({}).success(function(e){o.user=e;o.photos=o.user.photos;o.friends=o.user.friends;for(var t=0;o.friends&&t<o.friends.length;t++){r.getUserDataById(o.friends[t].userId).success(function(e){o.friendSchema.push({id:e.id,profilePhoto:e.profilePhoto,name:e.name,job:e.job,chat:o.friends[t].chat})}).error(function(e){alert("Error de fotos amigos profile")})}return false}).error(function(e){alert(e)});o.changeChat=function(e){o.friendchat=e}}})();(function(){angular.module("socialnetworkApp").controller("friendsCtrl",e);e.$inject=["$http","authentication","userData"];function e(e,t,r){alert("hola");var o=this;var n;o.friendPhotos=[];r.getUserData({}).success(function(e){n=e;o.pageHeader={name:n.name,friends:n.friends,cover:n.coverPage,profilePhoto:n.profilePhoto};o.photos=n.photos;o.friends=n.friends;for(var t=0;o.friends&&t<o.friends.length;t++){r.getUserDataById(o.friends[t].userId).success(function(e){o.friendPhotos.push({id:e.id,profilePhoto:e.profilePhoto,name:e.name,job:e.job})}).error(function(e){alert("Error de fotos amigos profile")})}return false}).error(function(e){alert(e)})}})();(function(){angular.module("socialnetworkApp").controller("friendsCtrl",e);e.$inject=["$scope","userData"];function e(e,t){e.friendPhotos=[];t.getUserData({}).success(function(r){e.friends=r.friends;for(var o=0;e.friends&&o<e.friends.length&&o<8;o++){t.getUserDataById(e.friends[o].userId).success(function(t){e.friendPhotos.push({id:t.id,profilePhoto:t.profilePhoto})}).error(function(e){alert("Error de fotos amigos profile")})}}).error(function(e){alert(e)})}})();(function(){angular.module("socialnetworkApp").controller("editProfileCtrl",e);e.$inject=["$location","authentication","userData"];function e(e,t,r){var o=this;r.getUserData({}).success(function(e){o.user=e}).error(function(e){alert(e)});o.changeAvatar=function(){o.user.profilePhoto="data:"+o.avatar.filetype+";base64,"+o.avatar.base64};o.changeCover=function(){o.user.coverPage="data:"+o.cover.filetype+";base64,"+o.cover.base64};o.returnPage="/home";o.submitEdit=function(){alert("Enviando");r.updateUserData(o.user).success(function(t){e.path("/profile")}).error(function(e){alert(e)})}}})();(function(){angular.module("socialnetworkApp").controller("pageHeaderCtrl",e);e.$inject=["$scope","userData"];function e(e,t){e.friendPhotos=[];t.getUserData({}).success(function(r){e.friends=r.friends;for(var o=0;e.friends&&o<e.friends.length&&o<8;o++){t.getUserDataById(e.friends[o].userId).success(function(t){e.friendPhotos.push({id:t.id,profilePhoto:t.profilePhoto})}).error(function(e){alert("Error de fotos amigos profile")})}}).error(function(e){alert(e)})}})();(function(){angular.module("socialnetworkApp").controller("postCtrl",e);e.$inject=["$scope","$location","authentication","userData"];function e(e,t,r,o){e.currentUser=r.currentUser();e.publications=[];o.getUserData({}).success(function(t){e.photo=t.profilePhoto;for(var r=0;t.publications&&r<t.publications.length;r++){e.publications.push({date:t.publications[r].date,text:t.publications[r].text,photo:t.publications[r].publicationPhoto})}}).error(function(e){alert(e)})}})();(function(){angular.module("socialnetworkApp").controller("postStateCtrl",e);e.$inject=["$scope","$location","authentication","userData"];function e(e,t,r,o){e.addPhoto=function(){e.uploadPhoto="data:"+e.photo.filetype+";base64,"+e.photo.base64};e.returnPage="/home";e.submitPublication=function(){o.createPublication({text:e.text,photo:e.uploadPhoto}).success(function(e){t.path("/profile")}).error(function(e){alert(e)})}}})();
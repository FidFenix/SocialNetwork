(function(){angular.module("socialnetworkApp",["ngRoute","ngSanitize","ui.bootstrap"]);function e(e,t){e.when("/",{templateUrl:"/home/home.view.html"}).when("/profile",{templateUrl:"/profiles/own_profile/profile.view.html"}).when("/index",{templateUrl:"index/index.view.html",controller:"indexCtrl",controllerAs:"vm"}).otherwise({redirectTo:"/"});t.html5Mode(true)}angular.module("socialnetworkApp").config(["$routeProvider","$locationProvider",e])})();(function(){angular.module("socialnetworkApp").controller("registerCtrl",e);e.$inject=["$scope","registerUser","geoLocation"];function e(e,t,r){var n=this;n.message="Checking your location";n.getData=function(e){var r=e.coords.latitude,o=e.coords.longitude;n.message="Searching for nearby places";var i;i={name:n.register.name,firstname:n.register.firstname,lastname:n.register.lastname,email:n.register.email,password:n.register.password,lat:r,lng:o};t.register(r,o,i).success(function(e){n.message="User Create";alert("USUARIO CREADO")}).error(function(e){n.message="Sorry, something's gone wrong, please try again later"})};n.showError=function(t){e.$apply(function(){n.message=t.message})};n.noGeo=function(){e.$apply(function(){n.message="Geolocation is not supported by this browser."})};n.registerSubmit=function(){r.getPosition(n.getData,n.showError,n.noGeo)}}})();(function(){angular.module("socialnetworkApp").service("geolocation",e);function e(){var e=function(e,t,r){if(navigator.geolocation){navigator.geolocation.getCurrentPosition(e,t)}else{r()}};return{getPosition:e}}})();(function(){angular.module("socialnetworkApp").service("registerUser",e);e.$inject=["$http"];function e(e){var t=function(t,r,n){return e.post("/api/users/create",JSON.stringify(n))};return{register:t}}})();(function(){angular.module("socialnetworkApp").service("authentication",e);e.$inject=["$http","$window"];function e(e,t){var r=function(e){t.localStorage["socialnetwork-token"]=e};var n=function(){return t.localStorage["socialnetwork-token"]};var o=function(){var e=n();if(e){var r=JSON.parse(t.atob(e.split(".")[1]));return r.exp>Date.now()/1e3}else{return false}};var i=function(){if(o()){var e=n();var r=JSON.parse(t.atob(e.split(".")[1]));return{id:r._id,email:r.email,name:r.name}}};register=function(t){return e.post("/api/register",t).success(function(e){r(e.token)})};login=function(t){return e.post("/api/login",t).success(function(e){r(e.token)})};logout=function(){t.localStorage.removeItem("socialnetwork-token")};return{currentUser:i,saveToken:r,getToken:n,isLoggedIn:o,register:register,login:login,logout:logout}}})();(function(){angular.module("socialnetworkApp").service("userData",e);e.$inject=["$http","authentication"];function e(e,t){var r=function(r){return e.post("/api/users/full",r,{headers:{Authorization:"Bearer "+t.getToken()}})};var n=function(t){return e.get("/api/users/partial/"+t)};return{getUserData:r,getUserDataById:n}}})();(function(){angular.module("socialnetworkApp").filter("formatDistance",t);var e=function(e){return!isNaN(parseFloat(e))&&isFinite(e)};function t(){return function(t){var r,n;if(t&&e(t)){if(t>1){r=parseFloat(t).toFixed(1);n="km"}else{r=parseInt(t*1e3,10);n="m"}return r+n}else{return"?"}}}})();(function(){angular.module("socialnetworkApp").directive("footerGeneric",e);function e(){return{restrict:"EA",templateUrl:"/common/directives/footerGeneric/footerGeneric.template.html"}}})();(function(){angular.module("socialnetworkApp").directive("modal",e);function e(){return{restrict:"EA",templateUrl:"/common/directives/navigation/modal.template.html"}}})();(function(){angular.module("socialnetworkApp").directive("navigation",e);function e(){return{restrict:"EA",templateUrl:"/common/directives/navigation/navigation.template.html"}}})();(function(){angular.module("socialnetworkApp").directive("chat",e);function e(){return{restrict:"EA",scope:{content:"=content"},templateUrl:"/common/directives/chat/chat.template.html"}}})();(function(){angular.module("socialnetworkApp").directive("pageHeader",e);function e(){return{restrict:"EA",scope:{content:"=content"},templateUrl:"/common/directives/own_profile/pageHeader/pageHeader.template.html",controller:"pageHeaderCtrl"}}})();(function(){angular.module("socialnetworkApp").directive("about",e);function e(){return{restrict:"EA",scope:{content:"=content"},templateUrl:"/common/directives/own_profile/widgets/about/about.template.html"}}})();(function(){angular.module("socialnetworkApp").directive("friends",e);function e(){return{restrict:"EA",templateUrl:"/common/directives/pageHeader/widgets/friends/friends.template.html"}}})();(function(){angular.module("socialnetworkApp").directive("group",e);function e(){return{restrict:"EA",templateUrl:"/common/directives/own_profile/widgets/group/group.template.html"}}})();(function(){angular.module("socialnetworkApp").directive("timeline",e);function e(){return{restrict:"EA",scope:{content:"=content"},templateUrl:"/common/directives/own_profile/timeline/timeline.template.html"}}})();(function(){angular.module("socialnetworkApp").directive("post",e);function e(){return{restrict:"EA",scope:{content:"=content"},templateUrl:"/common/directives/own_profile/timeline/post/post.template.html",controller:"postCtrl"}}})();(function(){angular.module("socialnetworkApp").directive("postState",e);function e(){return{restrict:"EA",templateUrl:"/common/directives/own_profile/timeline/postState/postState.template.html"}}})();(function(){angular.module("socialnetworkApp").controller("indexCtrl",e);e.$inject=["$location","authentication"];function e(e,t){var r=this;r.pageHeader={title:"Sign in to Loc8r"};r.credentialsLogin={email:"",password:""};r.credentialsRegister={name:"",firstname:"",lastname:"",email:"",password:""};r.returnPage="/home";r.onSubmitLogin=function(){alert("hola");r.formError="";if(!r.credentialsLogin.email||!r.credentialsLogin.password){r.formError="All fields required, please try again";return false}else{r.doLogin()}};r.doLogin=function(){r.formError="";alert("hola");t.login(r.credentialsLogin).error(function(e){r.formError=e}).then(function(){e.search("page",null);e.path(r.returnPage)})};r.onSubmitRegister=function(){r.formError="";if(!r.credentialsRegister.name||!r.credentialsRegister.email||!r.credentialsRegister.password){r.formError="All fields required, please try again";return false}else{r.doRegister()}};r.doRegister=function(){r.formError="";t.register(r.credentialsRegister).error(function(e){r.formError=e}).then(function(){e.search("page",null);e.path(r.returnPage)})}}})();(function(){angular.module("socialnetworkApp").controller("pageHeaderCtrl",e);e.$inject=["$scope","userData"];function e(e,t){for(var r=0;r<e.friends&&e.friends.length&&r<8;r++){t.getUserDataById(e.friends[r].userId).success(function(t){e.friendPhotos.push({id:t.id,profilePhoto:t.profilePhoto})}).error(function(e){alert("Error de fotos amigos profile")})}}})();(function(){angular.module("socialnetworkApp").controller("postCtrl",e);e.$inject=["$scope","$location","authentication","userData"];function e(e,t,r,n){e.userImage=function(e){n.getUserDataById(e).success(function(e){return e.profilePhoto}).error(function(e){alert(e)})};e.currentUser=r.currentUser()}})();